(контент був зимішан з "Fingerprint Web Application Framework")

# "Відбитки пільців" фреймворку

## Підсумок
Майже всі веб-додатки, які можна придумати, уже розроблені. З огляду на величезну кількість проектів безкоштовного програмного забезпечення з відкритим вихідним кодом, які активно розробляються та розгортаються в усьому світі, дуже ймовірно, що тест безпеки програми зіткнеться з метою, яка повністю або частково залежить від цих добре відомих програм або фреймворків (наприклад, WordPress, phpBB, Mediawiki тощо). Знання компонентів веб-додатків, які тестуються, значно допомагає в процесі тестування, а також суттєво зменшує зусилля, необхідні під час тестування. Ці добре відомі веб-програми мають відомі HTML-заголовки, файли cookie та структури каталогів, які можна пронумерувати, щоб ідентифікувати програму. Більшість веб-фреймворків мають кілька маркерів у цих місцях, які допомагають зловмиснику або тестувальнику їх розпізнати. В основному це те, що роблять усі автоматичні інструменти: вони шукають маркер із попередньо визначеного місця, а потім порівнюють його з базою даних відомих підписів. Для більшої точності зазвичай використовують кілька маркерів.

## Цілі тесту
- Відбиток компонентів, які використовуються веб-додатками.

## Як тестувати

### Тестування чорної скриньки
Існує кілька загальних місць, які слід розглянути, щоб визначити рамки або компоненти:
- HTTP заголовки
- Cookies
- Вихідний код HTML
- Конкретні файли та папки
- Розширення файлів
- Повідомлення про помилки

### Заголовки HTTP
Найпростіша форма ідентифікації веб-фреймворку – це подивитися на поле X-Powered-By у заголовку відповіді HTTP. Багато інструментів можна використовувати для відбитків пальців цілі, найпростішим є netcat.

Розглянемо такий HTTP-запит-відповідь:
\$ nc 127.0.0.1 80
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Server: nginx/1.0.14
[...]
X-Powered-By: Mono

З поля X-Powered-By ми розуміємо, що фреймворк веб-програми, ймовірно, буде Mono. Однак, хоча цей підхід простий і швидкий, ця методологія не працює в 100 відсотках випадків. Можна легко вимкнути заголовок X-Powered-By за допомогою відповідної конфігурації. Існує також кілька методів, які дозволяють веб-сайту маскувати заголовки HTTP (див. приклад у розділі «Виправлення»). У наведеному вище прикладі ми також можемо помітити, що для обслуговування вмісту використовується певна версія nginx.

Тож у тому ж прикладі тестер міг або пропустити заголовок X-Powered-By, або отримати таку відповідь:
HTTP/1.1 200 OK
Server: nginx/1.0.14
Date: Sat, 07 Sep 2013 08:19:15 GMT
Content-Type: text/html;charset=ISO-8859-1
Connection: close
Vary: Accept-Encoding
X-Powered-By: Blood, sweat and tears

Іноді існує більше HTTP-заголовків, які вказують на певну структуру. У наступному прикладі, згідно з інформацією з HTTP-запиту, видно, що заголовок X-Powered-By містить версію PHP. Однак заголовок X-Generator вказує на те, що використовуваний фреймворк насправді є Swiftlet, який допомагає тестувальнику проникнення розширити свої вектори атак. Виконуючи відбитки пальців, уважно перевіряйте кожен HTTP-заголовок на наявність таких витоків.
HTTP/1.1 200 OK
Server: nginx/1.4.1
Date: Sat, 07 Sep 2013 09:22:52 GMT
Content-Type: text/html
Connection: keep-alive
Vary: Accept-Encoding
X-Powered-By: PHP/5.4.16-1~dotdeb.1
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
X-Generator: Swiftlet

## Cookie-файли
Іншим подібним і дещо надійнішим способом визначення поточного веб-фреймворку є файли cookie для фреймворку.
Автоматично встановлено файл cookie CAKEPHP, який надає інформацію про використовувану структуру. Список поширених назв файлів cookie представлений у розділі файлів cookie. Досі існують обмеження щодо використання цього механізму ідентифікації – можна змінити назву файлів cookie. Наприклад, для вибраного фреймворку CakePHP це можна зробити за допомогою такої конфігурації (витяг із core.php):

/**
* The name of CakePHP's session cookie.
*
* Note the guidelines for Session names states: "The session name references
* the session id in cookies and URLs. It should contain only alphanumeric
* characters."
* @link http://php.net/session_name
*/
Configure::write('Session.cookie', 'CAKEPHP');

Однак ці зміни менш ймовірні, ніж зміни в заголовку X-Powered-By, тому такий підхід до ідентифікації можна вважати більш надійним.

## Вихідний код HTML
Цей метод заснований на пошуку певних шаблонів у вихідному коді HTML-сторінки. Часто можна знайти багато інформації, яка допомагає тестеру розпізнати певний компонент. Одним із поширених маркерів є коментарі HTML, які безпосередньо ведуть до розкриття фреймворку. Частіше можна знайти певні шляхи, пов’язані з фреймворком, тобто посилання на папки CSS або JS, що стосуються фреймворку. Нарешті, певні змінні сценарію також можуть вказувати на певну структуру.

На скріншоті нижче (я його не вставив) можна легко дізнатися використовуваний фреймворк і його версію за згаданими маркерами. Коментар, конкретні шляхи та змінні сценарію можуть допомогти зловмиснику швидко визначити примірник фреймворку ZK

Часто така інформація розміщується в розділі <head> HTTP-відповідей, у тегах <meta> або в кінці сторінки. Тим не менш, слід аналізувати цілі відповіді, оскільки це може бути корисним для інших цілей, таких як перевірка інших корисних коментарів і прихованих полів. Іноді веб-розробники не дуже піклуються про приховування інформації про використовувані фреймворки або компоненти. Ще можна натрапити на щось подібне внизу сторінки: "Build upon the Banshee PHP framework v3.1"

## Конкретні файли та папки
Існує ще один підхід, який значно допомагає зловмиснику або тестувальнику ідентифікувати програми або компоненти з високою точністю. Кожен веб-компонент має власну структуру файлів і папок на сервері. Було зазначено, що можна побачити конкретний шлях із вихідного коду сторінки HTML, але іноді вони не представлені явно там і все ще знаходяться на сервері.

Щоб виявити їх, використовується техніка, відома як примусовий перегляд або «dirbusting». Dirbusting — це грубе форсування цілі з відомими назвами папок і файлів і моніторинг HTTP-відповідей для перерахування вмісту сервера. Цю інформацію можна використовувати як для пошуку файлів за замовчуванням і їх атаки, так і для відбитків веб-додатків. Dirbusting можна здійснити декількома способами. Наведений нижче приклад (я його не вставив) демонструє успішну атаку dirbusting проти цілі, що працює на базі WordPress, за допомогою визначеного списку та функції зловмисників Burp Suite.

Ми бачимо, що для деяких папок WordPress (наприклад, /wp-includes/, /wp-admin/ і /wp-content/) HTTP-відповіді 403 (Заборонено), 302 (Знайдено, переспрямування на wp-login. php) і 200 (OK) відповідно. Це хороший показник того, що мета працює на основі WordPress. Таким же чином можна dirbust різних папок плагінів програм та їх версій. На знімку екрана нижче (я не вставив знімок) можна побачити типовий файл CHANGELOG плагіна Drupal, який надає інформацію про програму, що використовується, і розкриває вразливу версію плагіна.

Порада: перш ніж розпочинати dirbusting, спочатку перевірте файл robots.txt. Іноді там також можна знайти папки для певних програм та іншу конфіденційну інформацію. Приклад такого файлу robots.txt представлений на скріншоті нижче (не представив його)

Конкретні файли та папки відрізняються для кожної програми. Якщо визначена програма або компонент є відкритим вихідним кодом, може бути доцільно встановити тимчасову інсталяцію під час тестів на проникнення, щоб краще зрозуміти, яка інфраструктура чи функціональність представлена, а також які файли можуть залишитися на сервері. Проте кілька хороших списків файлів уже існують; гарним прикладом є списки слів FuzzDB передбачуваних файлів/папок.

## Розширення файлів
URL-адреси можуть містити розширення файлів, які також можуть допомогти ідентифікувати веб-платформу чи технологію.

Наприклад, вікі OWASP використовувала PHP:
https://wiki.owasp.org/index.php?title=Fingerprint_Web_Application_Framework&action=edit&section=4

Ось деякі поширені веб-розширення файлів і відповідні технології:
- .php – PHP
- .aspx – Microsoft ASP.NET
- .jsp – сторінки сервера Java

## Повідомлення про помилки
Як видно на наступному знімку екрана (не вставив його), указаний шлях до файлової системи вказує на використання WordPress (wp-content). Тестери також повинні знати, що WordPress базується на PHP (functions.php).

## Загальні ідентифікатори
## Cookie-файли
Framework	| Cookie name
Zope	zope3
CakePHP	cakephp
Kohana	kohanasession
Laravel	laravel_session
phpBB	phpbb3_
WordPress	wp-settings
1C-Bitrix	BITRIX_
AMPcms	AMP
Django CMS	django
DotNetNuke	DotNetNukeAnonymous
e107	e107_tz
EPiServer	EPiTrace, EPiServer
Graffiti CMS	graffitibot
Hotaru CMS	hotaru_mobile
ImpressCMS	ICMSession
Indico	MAKACSESSION
InstantCMS	InstantCMS[logdate]
Kentico CMS	CMSPreferredCulture
MODx	SN4[12symb]
TYPO3	fe_typo_user
Dynamicweb	Dynamicweb
LEPTON	lep[some_numeric_value]+sessionid
Wix	Domain=.wix.com
VIVVO	VivvoSessionId

## вихідний код HTML
Application	Keyword
WordPress	<meta name="generator" content="WordPress 3.9.2" />
phpBB	<body id="phpbb"
Mediawiki	<meta name="generator" content="MediaWiki 1.21.9" />
Joomla	<meta name="generator" content="Joomla! - Open Source Content Management" />
Drupal	<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
DotNetNuke	DNN Platform - [http://www.dnnsoftware.com](http://www.dnnsoftware.com)

## Загальні маркери
- %framework_name%
- powered by
- built upon
- running

## Конкретні маркери
Framework	Keyword
Adobe ColdFusion	<!-- START headerTags.cfm
Microsoft ASP.NET	__VIEWSTATE
ZK	<!-- ZK
Business Catalyst	<!-- BC_OBNW -->
Indexhibit	ndxz-studio

# Виправлення
Хоча можна спробувати використовувати різні імена файлів cookie (через зміну конфігурацій), приховати або змінити шляхи до файлів/каталогів (через переписування чи зміни вихідного коду), видалення відомих заголовків тощо, такі спроби зводяться до «безпеки через невідомість». Власники/адміністратори системи повинні розуміти, що ці зусилля сповільнюють лише найпростіших противники. Час/зусилля можна краще використати на обізнаність зацікавлених сторін і діяльність з підтримки рішення.

## Інструменти
Нижче наведено список загальних і добре відомих інструментів. Також є багато інших утиліт, а також фреймворкові інструменти зняття відбитків.

## WhatWeb
Веб-сайт: https://github.com/urbanadventurer/WhatWeb

На даний момент один із найкращих інструментів для зняття відбитків пальців на ринку. Входить до стандартної збірки Kali Linux. Мова: Ruby. Збіги для відбитків пальців створюються за допомогою:
- Текстові рядки (з урахуванням регістру)
- Регулярні вирази
- Запити до бази даних Google Hack (обмежений набір ключових слів)
- Хеші MD5
- розпізнавання URL
- Шаблони тегів HTML
- Користувацький ruby код для пасивних і агресивних операцій

## Wappalyzer
Веб-сайт: https://www.wappalyzer.com/
Wapplyzer доступний у кількох моделях використання, найпопулярнішою з яких, ймовірно, є розширення Firefox/Chrome. Вони працюють лише зі збігом регулярних виразів і не потребують нічого, окрім сторінки для завантаження у браузері. Він повністю працює на рівні браузера і дає результати у вигляді значків. Хоча іноді він має помилкові спрацьовування, це дуже зручно, щоб мати уявлення про те, які технології були використані для створення цільового веб-сайту одразу після перегляду сторінки.
